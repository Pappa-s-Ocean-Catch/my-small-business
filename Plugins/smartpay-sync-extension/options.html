<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SmartPay Sync - Settings</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 24px; }
    .wrap { max-width: 720px; margin: 0 auto; }
    h1 { margin: 0 0 12px; font-size: 20px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; }
    .row { margin-bottom: 14px; }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    input[type="text"], input[type="url"] { width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; }
    .hint { font-size: 12px; color: #6b7280; margin-top: 4px; }
    .actions { margin-top: 16px; display: flex; gap: 8px; }
    button { background: #2563eb; color: #fff; border: none; border-radius: 6px; padding: 10px 14px; cursor: pointer; }
    .secondary { background: #6b7280; }
    .status { margin-top: 10px; font-size: 13px; color: #065f46; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>SmartPay Sync - Settings</h1>
    <div class="card">
      <div class="row">
        <label for="webhookUrl">Webhook URL</label>
        <input id="webhookUrl" type="url" placeholder="https://business.truongthings.dev/api/webhooks/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
        <div class="hint">Your app's webhook endpoint that will receive SmartPay data.</div>
      </div>
      <div class="row">
        <label for="headerName">Auth Header Name</label>
        <input id="headerName" type="text" placeholder="X-API-Key">
      </div>
      <div class="row">
        <label for="headerValue">Auth Header Value</label>
        <input id="headerValue" type="text" placeholder="your-secret">
      </div>
      <div class="actions">
        <button id="saveBtn">Save</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>
      <div id="status" class="status"></div>
    </div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);

    async function load() {
      const { webhookUrl, webhookAuth } = await chrome.storage.sync.get(['webhookUrl', 'webhookAuth']);
      el('webhookUrl').value = webhookUrl || '';
      if (webhookAuth && typeof webhookAuth === 'object') {
        const [[name, value] = []] = Object.entries(webhookAuth);
        el('headerName').value = name || '';
        el('headerValue').value = value || '';
      } else if (typeof webhookAuth === 'string' && webhookAuth.includes(':')) {
        const [name, value] = webhookAuth.split(':').map(s => s.trim());
        el('headerName').value = name || '';
        el('headerValue').value = value || '';
      }
    }

    async function save() {
      const url = el('webhookUrl').value.trim();
      const name = el('headerName').value.trim();
      const value = el('headerValue').value.trim();
      const webhookAuth = name && value ? { [name]: value } : {};
      await chrome.storage.sync.set({ webhookUrl: url, webhookAuth });
      el('status').textContent = 'Saved';
      setTimeout(() => el('status').textContent = '', 1500);
    }

    async function reset() {
      await chrome.storage.sync.remove(['webhookUrl', 'webhookAuth']);
      el('webhookUrl').value = '';
      el('headerName').value = '';
      el('headerValue').value = '';
      el('status').textContent = 'Reset to defaults';
      setTimeout(() => el('status').textContent = '', 1500);
    }

    document.addEventListener('DOMContentLoaded', () => {
      load();
      el('saveBtn').addEventListener('click', save);
      el('resetBtn').addEventListener('click', reset);
    });
  </script>
</body>
</html>


